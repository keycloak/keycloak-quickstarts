{"version":3,"file":"MapperList-9e36e770.js","sources":["../../src/client-scopes/add/MapperDialog.tsx","../../src/client-scopes/details/MapperList.tsx"],"sourcesContent":["import { useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  Button,\n  ButtonVariant,\n  DataList,\n  DataListCell,\n  DataListItem,\n  DataListItemCells,\n  DataListItemRow,\n  Modal,\n  ModalVariant,\n  Text,\n  TextContent,\n  TextVariants,\n} from \"@patternfly/react-core\";\n\nimport type ProtocolMapperRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/protocolMapperRepresentation\";\nimport type { ProtocolMapperTypeRepresentation } from \"@keycloak/keycloak-admin-client/lib/defs/serverInfoRepesentation\";\n\nimport { useServerInfo } from \"../../context/server-info/ServerInfoProvider\";\nimport { ListEmptyState } from \"../../components/list-empty-state/ListEmptyState\";\nimport { KeycloakDataTable } from \"../../components/table-toolbar/KeycloakDataTable\";\nimport useLocaleSort, { mapByKey } from \"../../utils/useLocaleSort\";\n\ntype Row = {\n  name: string;\n  description: string;\n  item: ProtocolMapperRepresentation;\n};\n\nexport type AddMapperDialogModalProps = {\n  protocol: string;\n  filter?: ProtocolMapperRepresentation[];\n  onConfirm: (\n    value: ProtocolMapperTypeRepresentation | ProtocolMapperRepresentation[]\n  ) => void;\n};\n\nexport type AddMapperDialogProps = AddMapperDialogModalProps & {\n  open: boolean;\n  toggleDialog: () => void;\n};\n\nexport const AddMapperDialog = (props: AddMapperDialogProps) => {\n  const { t } = useTranslation(\"client-scopes\");\n\n  const serverInfo = useServerInfo();\n  const protocol = props.protocol;\n  const protocolMappers = serverInfo.protocolMapperTypes![protocol];\n  const builtInMappers = serverInfo.builtinProtocolMappers![protocol];\n  const [filter, setFilter] = useState<ProtocolMapperRepresentation[]>([]);\n  const [selectedRows, setSelectedRows] = useState<Row[]>([]);\n  const localeSort = useLocaleSort();\n\n  const allRows = useMemo(\n    () =>\n      localeSort(builtInMappers, mapByKey(\"name\")).map((mapper) => {\n        const mapperType = protocolMappers.filter(\n          (type) => type.id === mapper.protocolMapper\n        )[0];\n        return {\n          item: mapper,\n          name: mapper.name!,\n          description: mapperType.helpText,\n        };\n      }),\n    [builtInMappers, protocolMappers]\n  );\n  const [rows, setRows] = useState(allRows);\n\n  if (props.filter && props.filter.length !== filter.length) {\n    setFilter(props.filter);\n    const nameFilter = props.filter.map((f) => f.name);\n    setRows([...allRows.filter((row) => !nameFilter.includes(row.item.name))]);\n  }\n\n  const sortedProtocolMappers = useMemo(\n    () => localeSort(protocolMappers, mapByKey(\"name\")),\n    [protocolMappers]\n  );\n\n  const isBuiltIn = !!props.filter;\n\n  const header = [t(\"common:name\"), t(\"common:description\")];\n\n  return (\n    <Modal\n      aria-label={\n        isBuiltIn ? t(\"addPredefinedMappers\") : t(\"emptySecondaryAction\")\n      }\n      variant={ModalVariant.medium}\n      header={\n        <TextContent\n          role=\"dialog\"\n          aria-label={\n            isBuiltIn ? t(\"addPredefinedMappers\") : t(\"emptySecondaryAction\")\n          }\n        >\n          <Text component={TextVariants.h1}>\n            {isBuiltIn ? t(\"addPredefinedMappers\") : t(\"emptySecondaryAction\")}\n          </Text>\n          <Text>\n            {isBuiltIn\n              ? t(\"predefinedMappingDescription\")\n              : t(\"configureMappingDescription\")}\n          </Text>\n        </TextContent>\n      }\n      isOpen={props.open}\n      onClose={props.toggleDialog}\n      actions={\n        isBuiltIn\n          ? [\n              <Button\n                id=\"modal-confirm\"\n                data-testid=\"confirm\"\n                key=\"confirm\"\n                isDisabled={rows.length === 0 || selectedRows.length === 0}\n                onClick={() => {\n                  props.onConfirm(selectedRows.map(({ item }) => item));\n                  props.toggleDialog();\n                }}\n              >\n                {t(\"common:add\")}\n              </Button>,\n              <Button\n                id=\"modal-cancel\"\n                data-testid=\"cancel\"\n                key=\"cancel\"\n                variant={ButtonVariant.link}\n                onClick={() => {\n                  props.toggleDialog();\n                }}\n              >\n                {t(\"common:cancel\")}\n              </Button>,\n            ]\n          : []\n      }\n    >\n      {!isBuiltIn && (\n        <DataList\n          onSelectDataListItem={(id) => {\n            const mapper = protocolMappers.find((mapper) => mapper.id === id);\n            props.onConfirm(mapper!);\n            props.toggleDialog();\n          }}\n          aria-label={t(\"addPredefinedMappers\")}\n          isCompact\n        >\n          <DataListItem aria-label={t(\"headerName\")} id=\"header\">\n            <DataListItemRow>\n              <DataListItemCells\n                dataListCells={header.map((name) => (\n                  <DataListCell style={{ fontWeight: 700 }} key={name}>\n                    {name}\n                  </DataListCell>\n                ))}\n              />\n            </DataListItemRow>\n          </DataListItem>\n          {sortedProtocolMappers.map((mapper) => (\n            <DataListItem\n              aria-label={mapper.name}\n              key={mapper.id}\n              id={mapper.id}\n            >\n              <DataListItemRow>\n                <DataListItemCells\n                  dataListCells={[\n                    <DataListCell key={`name-${mapper.id}`}>\n                      {mapper.name}\n                    </DataListCell>,\n                    <DataListCell key={`helpText-${mapper.id}`}>\n                      {mapper.helpText}\n                    </DataListCell>,\n                  ]}\n                />\n              </DataListItemRow>\n            </DataListItem>\n          ))}\n        </DataList>\n      )}\n      {isBuiltIn && (\n        <KeycloakDataTable\n          loader={rows}\n          onSelect={setSelectedRows}\n          canSelectAll\n          ariaLabelKey=\"client-scopes:addPredefinedMappers\"\n          searchPlaceholderKey=\"common:searchForMapper\"\n          columns={[\n            {\n              name: \"name\",\n              displayKey: \"common:name\",\n            },\n            {\n              name: \"description\",\n              displayKey: \"common:description\",\n            },\n          ]}\n          emptyState={\n            <ListEmptyState\n              message={t(\"common:emptyMappers\")}\n              instructions={t(\"client-scopes:emptyBuiltInMappersInstructions\")}\n            />\n          }\n        />\n      )}\n    </Modal>\n  );\n};\n","import { useEffect, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport type { Path } from \"react-router-dom\";\nimport { Link } from \"react-router-dom\";\nimport { Dropdown, DropdownItem, DropdownToggle } from \"@patternfly/react-core\";\nimport { CaretDownIcon } from \"@patternfly/react-icons\";\n\nimport type ClientRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/clientRepresentation\";\nimport type ClientScopeRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/clientScopeRepresentation\";\nimport type ProtocolMapperRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/protocolMapperRepresentation\";\nimport type { ProtocolMapperTypeRepresentation } from \"@keycloak/keycloak-admin-client/lib/defs/serverInfoRepesentation\";\nimport { useServerInfo } from \"../../context/server-info/ServerInfoProvider\";\n\nimport { ListEmptyState } from \"../../components/list-empty-state/ListEmptyState\";\nimport { AddMapperDialog } from \"../add/MapperDialog\";\nimport {\n  Action,\n  KeycloakDataTable,\n} from \"../../components/table-toolbar/KeycloakDataTable\";\n\ntype MapperListProps = {\n  model: ClientScopeRepresentation | ClientRepresentation;\n  onAdd: (\n    mappers: ProtocolMapperTypeRepresentation | ProtocolMapperRepresentation[]\n  ) => void;\n  onDelete: (mapper: ProtocolMapperRepresentation) => void;\n  detailLink: (id: string) => Partial<Path>;\n};\n\ntype Row = ProtocolMapperRepresentation & {\n  category: string;\n  type: string;\n  priority: number;\n};\n\ntype MapperLinkProps = Row & {\n  detailLink: (id: string) => Partial<Path>;\n};\n\nconst MapperLink = ({ id, name, detailLink }: MapperLinkProps) => (\n  <Link to={detailLink(id!)}>{name}</Link>\n);\n\nexport const MapperList = ({\n  model,\n  onAdd,\n  onDelete,\n  detailLink,\n}: MapperListProps) => {\n  const { t } = useTranslation(\"client-scopes\");\n\n  const [mapperAction, setMapperAction] = useState(false);\n  const mapperList = model.protocolMappers;\n  const mapperTypes = useServerInfo().protocolMapperTypes![model.protocol!];\n\n  const [key, setKey] = useState(0);\n  useEffect(() => setKey(key + 1), [mapperList]);\n\n  const [addMapperDialogOpen, setAddMapperDialogOpen] = useState(false);\n  const [filter, setFilter] = useState(model.protocolMappers);\n  const toggleAddMapperDialog = (buildIn: boolean) => {\n    if (buildIn) {\n      setFilter(mapperList || []);\n    } else {\n      setFilter(undefined);\n    }\n    setAddMapperDialogOpen(!addMapperDialogOpen);\n  };\n\n  const loader = async () => {\n    if (!mapperList) {\n      return [];\n    }\n\n    const list = mapperList.reduce<Row[]>((rows, mapper) => {\n      const mapperType = mapperTypes.find(\n        ({ id }) => id === mapper.protocolMapper\n      );\n\n      if (!mapperType) {\n        return rows;\n      }\n\n      return rows.concat({\n        ...mapper,\n        category: mapperType.category,\n        type: mapperType.name,\n        priority: mapperType.priority,\n      });\n    }, []);\n\n    return list.sort((a, b) => a.priority - b.priority);\n  };\n\n  return (\n    <>\n      <AddMapperDialog\n        protocol={model.protocol!}\n        filter={filter}\n        onConfirm={onAdd}\n        open={addMapperDialogOpen}\n        toggleDialog={() => setAddMapperDialogOpen(!addMapperDialogOpen)}\n      />\n\n      <KeycloakDataTable\n        key={key}\n        loader={loader}\n        ariaLabelKey=\"client-scopes:clientScopeList\"\n        searchPlaceholderKey=\"common:searchForMapper\"\n        toolbarItem={\n          <Dropdown\n            onSelect={() => setMapperAction(false)}\n            toggle={\n              <DropdownToggle\n                isPrimary\n                id=\"mapperAction\"\n                onToggle={() => setMapperAction(!mapperAction)}\n                toggleIndicator={CaretDownIcon}\n              >\n                {t(\"common:addMapper\")}\n              </DropdownToggle>\n            }\n            isOpen={mapperAction}\n            dropdownItems={[\n              <DropdownItem\n                key=\"predefined\"\n                onClick={() => toggleAddMapperDialog(true)}\n              >\n                {t(\"fromPredefinedMapper\")}\n              </DropdownItem>,\n              <DropdownItem\n                key=\"byConfiguration\"\n                onClick={() => toggleAddMapperDialog(false)}\n              >\n                {t(\"byConfiguration\")}\n              </DropdownItem>,\n            ]}\n          />\n        }\n        actions={[\n          {\n            title: t(\"common:delete\"),\n            onRowClick: onDelete,\n          } as Action<Row>,\n        ]}\n        columns={[\n          {\n            name: \"name\",\n            cellRenderer: (row) => (\n              <MapperLink {...row} detailLink={detailLink} />\n            ),\n          },\n          { name: \"category\" },\n          {\n            name: \"type\",\n          },\n          {\n            name: \"priority\",\n          },\n        ]}\n        emptyState={\n          <ListEmptyState\n            message={t(\"common:emptyMappers\")}\n            instructions={t(\"common:emptyMappersInstructions\")}\n            secondaryActions={[\n              {\n                text: t(\"common:emptyPrimaryAction\"),\n                onClick: () => toggleAddMapperDialog(true),\n              },\n              {\n                text: t(\"emptySecondaryAction\"),\n                onClick: () => toggleAddMapperDialog(false),\n              },\n            ]}\n          />\n        }\n      />\n    </>\n  );\n};\n"],"names":["AddMapperDialog","props","t","useTranslation","serverInfo","useServerInfo","protocol","protocolMappers","builtInMappers","filter","setFilter","useState","selectedRows","setSelectedRows","localeSort","useLocaleSort","allRows","useMemo","mapByKey","mapper","mapperType","type","rows","setRows","nameFilter","f","row","sortedProtocolMappers","isBuiltIn","header","jsxs","Modal","ModalVariant","TextContent","jsx","Text","TextVariants","Button","item","ButtonVariant","DataList","id","DataListItem","DataListItemRow","DataListItemCells","name","DataListCell","KeycloakDataTable","ListEmptyState","MapperLink","detailLink","Link","MapperList","model","onAdd","onDelete","mapperAction","setMapperAction","mapperList","mapperTypes","key","setKey","useEffect","addMapperDialogOpen","setAddMapperDialogOpen","toggleAddMapperDialog","buildIn","loader","a","b","Fragment","Dropdown","DropdownToggle","CaretDownIcon","DropdownItem"],"mappings":"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"}